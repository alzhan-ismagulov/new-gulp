'use strict';

var Transform = require('readable-stream/transform');
var PluginError = require('gulp-util').PluginError;
var exec = require('child_process').exec,
    path = require("path");

module.exports = function() {
  return new Transform({
    objectMode: true,
    transform: function(file, enc, callback) {
      if (file.isNull()) {
        return callback(null, file);
      }      
      function doGenerate() {
        if (file.isStream()) {
          this.emit('error', new PluginError(PLUGIN_NAME, PLUGIN_NAME + ' not supports streams!'));
        } else if (file.isBuffer()) {
          let cmd = "fontforge -script "+__dirname+"/otf2ttf.sh "+file.path;
          
        	exec(cmd, {}, function(err, stdout, stderr){
              if (err !== null) {
                console.log('exec error: ' + err);
              }
          });
        }
        return callback(null, file);
      }

      doGenerate();
    }
  });
};